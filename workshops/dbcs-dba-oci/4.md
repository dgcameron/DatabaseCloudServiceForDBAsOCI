# DBCS Maintenance

## Introduction

While the Oracle Cloud has greatly simplified DBA tasks, the DBA still has a role to play in the development and maintenance of DBCA instances.  In this lab you will recover lost data and then use the Command Line Interface (CLI) to perform routine cloud and DBA tasks.

This lab supports the following use cases:
- Recovery of lost data
- Scripting tasks for automated execution.

To log issues and view the Lab Guide source, go to the [github oracle](https://github.com/oracle/learning-library/tree/master/workshops/dbcs-dba-oci) repository.

## Objectives

- Learn how to backup and recover data using RMAN.
- Become familiar with the command line interface.

## Required Artifacts

- The following lab requires you complete lab 1.

## **STEP 1**:  Back up the Database

- Log into RMAN and backup the database.  We will leave the RMAN default values.  Connect to the instance with RMAN (recovery manager).
```
rman target /
[oracle@workshop1-2 ~]$ rman target /

Recovery Manager: Release 19.0.0.0.0 - Production on Fri Jan 31 18:15:54 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database: ORCL (DBID=1557651837)
```

- Show the RMAN default configuration parameters.  We will leave them as is.
```
show all;
RMAN> show all;

using target database control file instead of recovery catalog
RMAN configuration parameters for database with db_unique_name ORCL_PHX3R6 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP ON; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK MAXPIECESIZE 2 G;
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '+RECO/ORCL_PHX3R6/controlfile/snapcf_orcl_phx3r6.f';
```

- Set encryption on and set archive log to current.
```
set encryption on;
RMAN> set encryption on;

executing command: SET encryption

alter system archive log current;
RMAN> alter system archive log current;

Statement processed
```

- Backup the database.
```
backup database plus archivelog;
RMAN> backup database plus archivelog;

Starting backup at 31-JAN-20
current log archived
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=187 device type=DISK
channel ORA_DISK_1: starting archived log backup set
channel ORA_DISK_1: specifying archived log(s) in backup set
input archived log thread=1 sequence=8 RECID=1 STAMP=1030930215
input archived log thread=1 sequence=9 RECID=5 STAMP=1030930277
input archived log thread=1 sequence=10 RECID=4 STAMP=1030930276
input archived log thread=1 sequence=11 RECID=2 STAMP=1030930242
input archived log thread=1 sequence=12 RECID=3 STAMP=1030930247
input archived log thread=1 sequence=13 RECID=6 STAMP=1030930283
input archived log thread=1 sequence=14 RECID=7 STAMP=1030930291
input archived log thread=1 sequence=15 RECID=8 STAMP=1031163430
input archived log thread=1 sequence=16 RECID=9 STAMP=1031163443
channel ORA_DISK_1: starting piece 1 at 31-JAN-20
channel ORA_DISK_1: finished piece 1 at 31-JAN-20
piece handle=+RECO/ORCL_PHX3R6/BACKUPSET/2020_01_31/annnf0_tag20200131t181724_0.285.1031163445 tag=TAG20200131T181724 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:15
Finished backup at 31-JAN-20

Starting backup at 31-JAN-20
using channel ORA_DISK_1
channel ORA_DISK_1: starting full datafile backup set
channel ORA_DISK_1: specifying datafile(s) in backup set
input datafile file number=00001 name=+DATA/ORCL_PHX3R6/DATAFILE/system.280.1030929979
input datafile file number=00003 name=+DATA/ORCL_PHX3R6/DATAFILE/sysaux.287.1030929977
input datafile file number=00004 name=+DATA/ORCL_PHX3R6/DATAFILE/undotbs1.275.1030929975
input datafile file number=00011 name=+DATA/ORCL_PHX3R6/DATAFILE/users.291.1030929979
channel ORA_DISK_1: starting piece 1 at 31-JAN-20
channel ORA_DISK_1: finished piece 1 at 31-JAN-20
piece handle=+RECO/ORCL_PHX3R6/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.286.1031163461 tag=TAG20200131T181740 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:25
channel ORA_DISK_1: starting full datafile backup set
channel ORA_DISK_1: specifying datafile(s) in backup set
input datafile file number=00009 name=+DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/sysaux.288.1030929975
input datafile file number=00008 name=+DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/system.292.1030929977
input datafile file number=00014 name=+DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive.289.1030929975
input datafile file number=00046 name=+DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/test.274.1030929977
input datafile file number=00010 name=+DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/undotbs1.262.1030929975
input datafile file number=00012 name=+DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/users.263.1030929975
channel ORA_DISK_1: starting piece 1 at 31-JAN-20
channel ORA_DISK_1: finished piece 1 at 31-JAN-20
piece handle=+RECO/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.287.1031163487 tag=TAG20200131T181740 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:07
channel ORA_DISK_1: starting full datafile backup set
channel ORA_DISK_1: specifying datafile(s) in backup set
input datafile file number=00065 name=+DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/sysaux.272.1031092865
input datafile file number=00064 name=+DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/system.266.1031092865
input datafile file number=00067 name=+DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/alpha_archive.273.1031092929
input datafile file number=00068 name=+DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/users.294.1031092935
input datafile file number=00066 name=+DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/undotbs1.271.1031092865
channel ORA_DISK_1: starting piece 1 at 31-JAN-20
channel ORA_DISK_1: finished piece 1 at 31-JAN-20
piece handle=+RECO/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.288.1031163495 tag=TAG20200131T181740 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:07
channel ORA_DISK_1: starting full datafile backup set
channel ORA_DISK_1: specifying datafile(s) in backup set
input datafile file number=00006 name=+DATA/ORCL_PHX3R6/9C47B599375B63A7E0530700000A795D/DATAFILE/sysaux.282.1030929975
input datafile file number=00005 name=+DATA/ORCL_PHX3R6/9C47B599375B63A7E0530700000A795D/DATAFILE/system.286.1030929975
input datafile file number=00007 name=+DATA/ORCL_PHX3R6/9C47B599375B63A7E0530700000A795D/DATAFILE/undotbs1.267.1030929977
channel ORA_DISK_1: starting piece 1 at 31-JAN-20
channel ORA_DISK_1: finished piece 1 at 31-JAN-20
piece handle=+RECO/ORCL_PHX3R6/9C47B599375B63A7E0530700000A795D/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.289.1031163501 tag=TAG20200131T181740 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:07
Finished backup at 31-JAN-20

Starting backup at 31-JAN-20
current log archived
using channel ORA_DISK_1
channel ORA_DISK_1: starting archived log backup set
channel ORA_DISK_1: specifying archived log(s) in backup set
input archived log thread=1 sequence=17 RECID=10 STAMP=1031163507
channel ORA_DISK_1: starting piece 1 at 31-JAN-20
channel ORA_DISK_1: finished piece 1 at 31-JAN-20
piece handle=+RECO/ORCL_PHX3R6/BACKUPSET/2020_01_31/annnf0_tag20200131t181828_0.291.1031163509 tag=TAG20200131T181828 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:01
Finished backup at 31-JAN-20

Starting Control File and SPFILE Autobackup at 31-JAN-20
piece handle=+RECO/ORCL_PHX3R6/AUTOBACKUP/2020_01_31/s_1031163509.292.1031163509 comment=NONE
Finished Control File and SPFILE Autobackup at 31-JAN-20

RMAN> 
```

- List/confirm backup and create restore point.  Enter the following
```
list backup summary;
RMAN> list backup summary;

List of Backups
===============
Key     TY LV S Device Type Completion Time #Pieces #Copies Compressed Tag
------- -- -- - ----------- --------------- ------- ------- ---------- ---
1       B  F  X DISK        16-JAN-20       1       1       NO         TAG20200116T194457
2       B  F  X DISK        21-JAN-20       1       1       NO         TAG20200121T002828
3       B  F  X DISK        21-JAN-20       1       1       NO         TAG20200121T160409
4       B  F  X DISK        21-JAN-20       1       1       NO         TAG20200121T164307
...

9       B  F  X DISK        22-JAN-20       1       1       NO         TAG20200122T155444
10      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
11      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
12      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
13      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
14      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
15      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
16      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
17      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
18      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
19      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
20      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
21      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
22      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
23      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
24      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
25      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
26      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
27      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
28      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_DB
29      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_CTL
30      B  0  A SBT_TAPE    22-JAN-20       1       1       YES        ZDM_ORCL_PHX273_STBY
31      B  F  A SBT_TAPE    22-JAN-20       1       1       NO         TAG20200122T195305
...

109     B  F  A DISK        31-JAN-20       1       1       NO         TAG20200131T181829
```

- Create restore point and then exit from RMAN.
```
create restore point gold preserve;
RMAN> create restore point gold preserve;

Statement processed

RMAN> exit -- from RMAN

Recovery Manager complete.
```

## **STEP 2**:  Drop a Table 'Accidently'

- Exit from RMAN and log into alpha and drop table and then exit from sqlplus.
```
sqlplus alpha/<password>@pdb1;
[oracle@workshop1-2 ~]$ sqlplus alpha/<password>@pdb1 

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Jan 31 18:30:53 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Last Successful login time: Thu Jan 23 2020 18:01:44 +00:00

Connected to:
Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0

SQL> drop table order_items;

Table dropped.

SQL> exit
Disconnected from Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0
```

## **STEP 3**:  Recover the Database.

- Log into the database with sys and restart the Database in `Mount` mode.
```
sqlplus sys/<password> as sysdba
[oracle@workshop1-2 ~]$ sqlplus sys/<password> as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Jan 31 18:31:40 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0

SQL> shutdown immediate;
Database closed.
Database dismounted.
ORACLE instance shut down.

startup mount
SQL> startup mount 
ORACLE instance started.

Total System Global Area 1.6106E+10 bytes
Fixed Size		    9154008 bytes
Variable Size		 2315255808 bytes
Database Buffers	 1.3757E+10 bytes
Redo Buffers		   24399872 bytes
Database mounted.
```

- Open the keystore and then exit from sqlplus.
```
administer key management set keystore open identified by <password> container=all;
SQL> administer key management set keystore open identified by <password> container=all;

keystore altered.

SQL> exit -- from sqlplus
Disconnected from Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0
```

- Log into RMAN to restore the database.
```
rman target /
[oracle@workshop1-2 ~]$ rman target /

Recovery Manager: Release 19.0.0.0.0 - Production on Fri Jan 31 19:12:40 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database: ORCL (DBID=1557651837, not open)
```

- Restore the database and then exit from RMAN.
```
run {restore database; recover database to restore point gold; alter database open resetlogs;}
RMAN> run {restore database; recover database to restore point gold; alter database open resetlogs;}

Starting restore at 31-JAN-20
using target database control file instead of recovery catalog
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=13 device type=DISK

skipping datafile 14; already restored to file +DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/alpha_archive.289.1030929975
skipping datafile 5; already restored to file +DATA/ORCL_PHX3R6/9C47B599375B63A7E0530700000A795D/DATAFILE/system.286.1030929975
skipping datafile 6; already restored to file +DATA/ORCL_PHX3R6/9C47B599375B63A7E0530700000A795D/DATAFILE/sysaux.282.1030929975
skipping datafile 7; already restored to file +DATA/ORCL_PHX3R6/9C47B599375B63A7E0530700000A795D/DATAFILE/undotbs1.267.1030929977
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00001 to +DATA/ORCL_PHX3R6/DATAFILE/system.280.1030929979
channel ORA_DISK_1: restoring datafile 00003 to +DATA/ORCL_PHX3R6/DATAFILE/sysaux.287.1030929977
channel ORA_DISK_1: restoring datafile 00004 to +DATA/ORCL_PHX3R6/DATAFILE/undotbs1.275.1030929975
channel ORA_DISK_1: restoring datafile 00011 to +DATA/ORCL_PHX3R6/DATAFILE/users.291.1030929979
channel ORA_DISK_1: reading from backup piece +RECO/ORCL_PHX3R6/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.286.1031163461
channel ORA_DISK_1: piece handle=+RECO/ORCL_PHX3R6/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.286.1031163461 tag=TAG20200131T181740
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:26
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00008 to +DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/system.292.1030929977
channel ORA_DISK_1: restoring datafile 00009 to +DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/sysaux.288.1030929975
channel ORA_DISK_1: restoring datafile 00010 to +DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/undotbs1.262.1030929975
channel ORA_DISK_1: restoring datafile 00012 to +DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/users.263.1030929975
channel ORA_DISK_1: restoring datafile 00046 to +DATA/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/DATAFILE/test.274.1030929977
channel ORA_DISK_1: reading from backup piece +RECO/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.287.1031163487
channel ORA_DISK_1: piece handle=+RECO/ORCL_PHX3R6/9C47D64835F00F3BE0530700000A3085/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.287.1031163487 tag=TAG20200131T181740
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:15
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00064 to +DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/system.266.1031092865
channel ORA_DISK_1: restoring datafile 00065 to +DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/sysaux.272.1031092865
channel ORA_DISK_1: restoring datafile 00066 to +DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/undotbs1.271.1031092865
channel ORA_DISK_1: restoring datafile 00067 to +DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/alpha_archive.273.1031092929
channel ORA_DISK_1: restoring datafile 00068 to +DATA/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/DATAFILE/users.294.1031092935
channel ORA_DISK_1: reading from backup piece +RECO/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.288.1031163495
channel ORA_DISK_1: piece handle=+RECO/ORCL_PHX3R6/9D64263EC0913583E0530800000AF2FC/BACKUPSET/2020_01_31/nnndf0_tag20200131t181740_0.288.1031163495 tag=TAG20200131T181740
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:15
Finished restore at 31-JAN-20

Starting recover at 31-JAN-20
using channel ORA_DISK_1
datafile 14 not processed because file is read-only

starting media recovery
media recovery complete, elapsed time: 00:00:02

Finished recover at 31-JAN-20

Statement processed

RMAN> exit

Recovery Manager complete.
```

## **STEP 4**:  Confirm Data Recovery

- Log into sys and open pluggable databases and password wallet.
```
sqlplus sys/<password> as sysdba;
[oracle@workshop1-2 ~]$ sqlplus sys/WelCome1234#_ as sysdba;

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Jan 31 19:37:07 2020
Version 19.5.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0

alter pluggable database all open;
Pluggable database altered.

alter session set container=pdb1;
Session altered.

administer key management set keystore open force keystore identified by <password>;
keystore altered.
```

- Connect as alpha and confirm order_items table is restored, then exit from sqlplus.
```
connect alpha/<password>@pdb1;
Connected.

select count(*) from order_items;
  COUNT(*)
----------
	 4

exit;
SQL> exit
Disconnected from Oracle Database 19c EE High Perf Release 19.0.0.0.0 - Production
Version 19.5.0.0.0
```

# Using the Oracle Command Line Interface (CLI) to manage DBCS Instances

## Introduction

In this Lab you will use the Oracle Command Line Interface (CLI) to retrieve information about the configuration and status of various cloud services without the need to use the Cloud Console.  Note you may wish to open a separate text window with your identity domain account and password to copy/paste these into the placeholders in the following commands, and then copy this into the terminal windows.

This lab supports the following use cases:
-	Use of Oracle's API to manage cloud databases.

To log issues and view the Lab Guide source, go to the [github oracle](https://github.com/oracle/learning-library/tree/master/workshops/dbcs-dba-oci) repository.

## Objectives

- Install Oracle CLI
- Use OCI commands to request information about DBCS related configuration and services.
- Create services with oci commands.

## Required Artifacts

-   There are no dependencies for this lab.

## Create an Object Store Bucket and Install Oracle CLI.

### **STEP 1**:  Create an Object Store Bucket. Note you may have done this as part of the setup or part of lab 300.  If so you can skip this step. 

- To create an object store bucket go to the cloud console and select Database (OCI).

  ![](images/5/002.png)

  ![](images/5/003.png)

- Select Storage - Object Storage and select the Demo Compartment (or your working compartment).

  ![](images/5/004.png)

  ![](images/5/005.png)

- Select `Create Bucket`.

  ![](images/5/006.png)

- Call the Bucket `alpha`.  Accept the defaults.

  ![](images/5/007.png)

We will use the bucket later.

### **STEP 2**:  Collect Keys for use by the Oracle CLI in Step 3

- The following keys will be needed.  If you configured and ran Terraform as part of the setup to this workshop you will already have these keys in the Terraform configuration (file env_vars.bat) on your desktop.  If someone else ran the setup on your behalf (or as part of the setup by an instructor) proceed with the following steps to obtain the keys.  Open a notepad and save these for the configuration in step 3:
  - `tenancy` (select tenancy and then copy OCID)

  ![](images/5/008.png)

  - `region`

  ![](images/5/009.png)

  - `compartment`

  ![](images/5/010.png)

  - `user`

  - `fingerprint `


### **STEP 3**:  Install Oracle CLI

- **We need to use the opc user for the following steps**.  Open a terminal window and enter the following.  
```
ssh -i /tmp/ws/privateKey opc@localhost (log into the WorkshopImage as opc)

sudo yum -y install gcc libffi-devel python-devel openssl-devel (enter Y to all prompts)

sudo yum clean all
```
![](images/5/011.png)

![](images/5/012.png)

- Now install the CLI.  Enter the following.  This will take a few minutes.
```
bash -c "$(curl -L https://raw.githubusercontent.com/oracle/oci-cli/master/scripts/install/install.sh)" (accept the defaults (Y))
```
![](images/5/013.png)

![](images/5/014.png)

- Set the locale:
```
export LC_ALL=en_US.utf8
```
- Configure CLI.  Enter the following:
```
oci setup config (take the defaults)
```
  ![](images/5/015.png)

- Respond to prompts with the OCIDs you copied in the previous step.  Accept Y to generate a new RSA key pair and accept location defaults.

  ![](images/5/016.png)

### **STEP 4**:  Upload the Public Key

- We need to upload the public key.  Go to Identity - Users.  Then click on the `api.user` user, and then click on `Add Public Key`.

  ![](images/5/017.png)

  ![](images/5/018.png)

  ![](images/5/019.png)

- While the Add Public Key is open enter the following in the terminal window.  We will paste the key contents into this open window, which is still logged in as opc through a SSH session.
```
cat /home/opc/.oci/oci_api_key_public.pem
```
![](images/5/020.png)

- Highlight the key and right click to copy.  Then paste into the key window.

  ![](images/5/021.png)

  ![](images/5/022.png)

- Copy the fingerprint to your notepad.  We'll use this later. 

  ![](images/5/023.png)

## Example CLI Requests

### **STEP 5**: Retrieve Cloud Environment Objects

-	List regions.  Enter the following in a command window.  Note, if you closed out of the previous session and need to start a NEW terminal window, you will need to ssh back into opc (`ssh -i /tmp/ws/privateKey opc@localhost`), and then set your language variable (`export LC_ALL=en_US.utf8`).
```
oci iam region list --output table
```
  ![](images/5/024.png)

-	List compute images.  Substitute your compartment-id in the <compartment-id> placeholder.
```
oci compute image list -c <compartment-id> --output table --query "data [*].{ImageName:\"display-name\", OCID:id}"
```
  ![](images/5/025.png)

### **STEP 6**: Retrieve Database Related Information and Create a New VCN

- When installing the CLI tool a config file was generated and you enter some information in the prompts.  This information can be entered in the command line as parameters, but this can become lengthy.  Note that the install created a `.oci` (hidden) directory in the user's home directory.  Review the contents - enter the following. We will be make more CLI requests that will have additional parameters.  These parameters can be added to the config file to save typing in the future.
```
ls -l .oci
cat .oci/config
```
![](images/5/026.png)

- Besides reading the CLI reference documentation, an additional tip is to use the -h (or --help) parameter.  To see this enter the following:
```
oci db database -h (scroll down, and then hit q to exit)
oci db database list -h (enter q to quit)
```
![](images/5/027.png)

![](images/5/028.png)

- To list databases (within database services) we'll need the db-system-id.  Go to the cloud console to get that.  Select the Alpha01A-DBCS system, and then select the OCID:

  ![](images/5/029.png)

  ![](images/5/030.png)

- Then go back to the terminal window and enter the following:
```
oci db database list --compartment-id <copy your compartment-id from above> --db-system-id <paste the OCID here>
```
![](images/5/031.png)

- List Virtual Cloud Networks. 
```
oci network vcn list -c <copy your compartment-id here> (note that -c is a shortcut for --compartment-id)
```
![](images/5/032.png)

- Create a new VCN.  First review our current VCN (menu Network - Virtual Cloud Network).
```
oci network vcn create -c <copy your compartment-id here> (note that -c is a shortcut for --compartment-id) --cidr-block "10.0.0.0/16"
```
  ![](images/5/033.png)

- Create a new VNC.  Note you will need to supply an additional parameter - cidr-block.  We can copy that from the previous command.

  ![](images/5/034.png)

- Go back to the Cloud Console and confirm the VCN was created.

  ![](images/5/035.png)

### **STEP 7**: Upload Files to Object Storage

- Change permissions of alpha.dmp file in /tmp/ws so opc can read and upload it
```
sudo su - oracle
chmod a+r /tmp/ws/oci_ws_alpha.dmp
exit
```
- Upload alpha.dmp to object storage.  We can multi-thread the upload.
```
oci os object put -ns <identity domain name> -bn alpha --file /tmp/ws/oci_ws_alpha.dmp --name oci_ws_alpha.dmp --part-size 10 --parallel-upload-count 10 --bucket-name=alpha
```
![](images/5/036.png)

- Confirm the file was uploaded.  Navigate to Object Storage and review the alpha bucket (menu Storage - Object Storage).

  ![](images/5/037.png)